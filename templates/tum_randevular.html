{% extends 'base.html' %}

{# Template: TÃ¼m randevularÄ± listeler (yÃ¶netim)
   View: `rezervasyon.views.tum_randevular`
   Beklenen context: 'randevular'
#}

{% block icerik %}
<div class="container mt-4 mb-5">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>ğŸ“… TÃ¼m Randevu KayÄ±tlarÄ±</h3>
        <a href="{% url 'egitmen_paneli' %}" class="btn btn-secondary">ğŸ”™ Panele DÃ¶n</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-bordered align-middle mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Ã–ÄŸrenci AdÄ±</th>
                            <th>Okul No</th>
                            <th>Cihaz</th>
                            <th>Tarih & Saat</th>
                            <th>Durum</th>
                            <th style="width: 150px;">Ä°ÅŸlem</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for randevu in randevular %}
                        <tr>
                            <td>
                                <span class="fw-bold">
                                    {{ randevu.kullanici.first_name }} {{ randevu.kullanici.last_name }}
                                </span>
                            </td>

                            <td>
                                {{ randevu.kullanici.profil.okul_numarasi|default:"--" }}
                            </td>

                            <td>
                                <strong>{{ randevu.cihaz.isim }}</strong><br>
                                <small class="text-muted">{{ randevu.cihaz.lab.isim }}</small>
                            </td>

                            <td>
                                {{ randevu.tarih|date:"d.m.Y" }} <br>
                                <span class="badge bg-light text-dark border">
                                    {{ randevu.baslangic_saati }} - {{ randevu.bitis_saati }}
                                </span>
                            </td>

                            <td>
                                {% if randevu.durum == 'geldi' %}
                                <span class="badge bg-success">GELDÄ°</span>
                                {% elif randevu.durum == 'gelmedi' %}
                                <span class="badge bg-danger">GELMEDÄ°</span>
                                {% elif randevu.durum == 'bekliyor' or randevu.durum == 'bekleniyor' %}
                                <span class="badge bg-warning text-dark">ONAY BEKLÄ°YOR</span>
                                {% elif randevu.durum == 'iptal' %}
                                <span class="badge bg-secondary">Ä°PTAL</span>
                                {% elif randevu.durum == 'onaylandi' %}
                                <span class="badge bg-primary">ONAYLANDI</span>
                                {% elif randevu.durum == 'reddedildi' %}
                                <span class="badge bg-danger">REDDEDÄ°LDÄ°</span>
                                {% else %}
                                <span class="badge bg-info">{{ randevu.durum|upper }}</span>
                                {% endif %}
                            </td>

                            <td>
                                {% if randevu.durum == 'bekliyor' or randevu.durum == 'bekleniyor' %}
                                <a href="{% url 'durum_guncelle' randevu.id 'onaylandi' %}"
                                    class="btn btn-sm btn-success" title="Onayla">âœ”ï¸</a>
                                <a href="{% url 'durum_guncelle' randevu.id 'reddedildi' %}"
                                    class="btn btn-sm btn-danger" title="Reddet">âŒ</a>
                                {% else %}
                                <a href="{% url 'randevu_iptal' randevu.id %}" class="btn btn-sm btn-outline-secondary"
                                    onclick="return confirm('Bu kaydÄ± silmek istediÄŸinize emin misiniz?');">ğŸ—‘ï¸ Sil</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center py-4">KayÄ±t bulunamadÄ±.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}